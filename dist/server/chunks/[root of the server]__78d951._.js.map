{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/shhad/OneDrive/Desktop/test-landing/app/config/agents.js"],"sourcesContent":["export const allowedAgents = [\r\n  {\r\n    id: 'shadisleem',\r\n    name: 'שאדי סלים',\r\n    email: 'shadisleem@gmail.com'\r\n  },\r\n  {\r\n    id: 'shhadyserhan',\r\n    name: 'שחאדה סרחאן',\r\n    email: 'shhadyse@gmail.com'\r\n  }\r\n]; "],"names":[],"mappings":";;;AAAO,MAAM,gBAAgB;IAC3B;QACE,IAAI;QACJ,MAAM;QACN,OAAO;IACT;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO;IACT;CACD"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/shhad/OneDrive/Desktop/test-landing/app/api/send-email/route.js"],"sourcesContent":["export const config = {\r\n  api: {\r\n    bodyParser: false\r\n  },\r\n};\r\n\r\nimport { NextResponse } from 'next/server';\r\nimport { Resend } from 'resend';\r\nimport { allowedAgents } from '../../config/agents';\r\n\r\nconst resendApiKey = process.env.RESEND_API_KEY;\r\nconst resend = new Resend(resendApiKey);\r\n\r\nexport async function POST(request) {\r\n  if (!resendApiKey) {\r\n    return NextResponse.json(\r\n      { error: 'Server configuration error: Missing API key' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n\r\n  try {\r\n    const contentType = request.headers.get('content-type') || '';\r\n    let body;\r\n    let bankApprovalPdf;\r\n    let pdfBuffer;\r\n\r\n    if (contentType.includes('multipart/form-data')) {\r\n      const formData = await request.formData();\r\n      bankApprovalPdf = formData.get('bankApprovalPdf');\r\n      \r\n      body = {};\r\n      for (let [key, value] of formData.entries()) {\r\n        if (key === 'bankApprovalPdf') {\r\n          const pdfArrayBuffer = await value.arrayBuffer();\r\n          pdfBuffer = Buffer.from(pdfArrayBuffer);\r\n        } else {\r\n          body[key] = value === 'null' || value === 'undefined' ? null : value;\r\n        }\r\n      }\r\n    } else {\r\n      body = await request.json();\r\n    }\r\n\r\n    // Get agent's full name if agentName is provided\r\n    let agentFullName = '';\r\n    if (body.agentName) {\r\n      const agent = allowedAgents.find(agent => agent.id === body.agentName);\r\n      if (agent) {\r\n        agentFullName = agent.name;\r\n      }\r\n    }\r\n\r\n    const emailContent = `<div dir=\"rtl\" style=\"text-align: right; direction: rtl; font-family: Arial, sans-serif;\">\r\n      <h1 style=\"color: #333; border-bottom: 2px solid #1b283c; padding-bottom: 10px;\">פרטי טופס חדש</h1>\r\n\r\n      ${agentFullName ? `\r\n      <div style=\"margin: 20px 0; padding: 15px; background-color: #f0f7ff; border-radius: 8px;\">\r\n        <h3 style=\"color: #1b283c; margin: 0;\">🎯 פרטי סוכן</h3>\r\n        <p style=\"margin: 10px 0 0 0;\">• שם הסוכן: ${agentFullName}</p>\r\n      </div>\r\n      ` : ''}\r\n\r\n      <div style=\"margin: 20px 0;\">\r\n        <h3 style=\"color: #1b283c;\">⚡ סטטוס תעסוקה</h3>\r\n        <p>• סיים לעבוד: ${body.finishedWork}</p>\r\n        <p>• תאריך סיום: ${body.endDate || 'לא צוין'}</p>\r\n        <p>• טפסי 161: ${body.closingPapers}</p>\r\n        <p>• עובד כיום: ${body.currentEmploymentStatus}</p>\r\n        <p>• משכורת נוכחית: ${body.salary || 'לא צוין'}</p>\r\n        <p>• מעסיק נוכחי: ${body.employerName || 'לא צוין'}</p>\r\n      </div>\r\n\r\n      <div style=\"margin: 20px 0;\">\r\n        <h3 style=\"color: #1b283c;\">🏥 מצב רפואי ופיננסי</h3>\r\n        <p>• בעיות משפטיות: ${body.financialIssues}</p>\r\n        <p>• נכות: ${body.disability}</p>\r\n        <p>• תביעת נכות: ${body.disabilityClaim}</p>\r\n      </div>\r\n\r\n      <div style=\"margin: 20px 0;\">\r\n        <h3 style=\"color: #1b283c;\">👤 פרטים אישיים</h3>\r\n        <p>• שם מלא: ${body.fullName}</p>\r\n        <p>• טלפון: ${body.phone}</p>\r\n        <p>• ת.ז: ${body.idNumber}</p>\r\n        <p>• עיר: ${body.city}</p>\r\n        <p>• מוכן לשיחה: ${body.transparentCall}</p>\r\n      </div>\r\n\r\n      <div style=\"margin: 20px 0;\">\r\n        <h3 style=\"color: #1b283c;\">📎 קבצים מצורפים</h3>\r\n        <div style=\"background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;\">\r\n          <p style=\"margin: 10px 0;\">\r\n            <strong>צילום ת.ז - צד 1:</strong><br>\r\n            <a href=\"${body.idFront}\" target=\"_blank\" style=\"color: #0070f3; text-decoration: none; margin-right: 10px;\">\r\n              👁️ צפייה\r\n            </a>\r\n          </p>\r\n          \r\n          <p style=\"margin: 10px 0;\">\r\n            <strong>צילום ת.ז - צד 2:</strong><br>\r\n            <a href=\"${body.idBack}\" target=\"_blank\" style=\"color: #0070f3; text-decoration: none; margin-right: 10px;\">\r\n              👁️ צפייה\r\n            </a>\r\n          </p>\r\n          \r\n          <p style=\"margin: 10px 0;\">\r\n            <strong>צילום ספח ת.ז:</strong><br>\r\n            <a href=\"${body.idAttachment}\" target=\"_blank\" style=\"color: #0070f3; text-decoration: none; margin-right: 10px;\">\r\n              👁️ צפייה\r\n            </a>\r\n          </p>\r\n          \r\n          <p style=\"margin: 10px 0;\">\r\n            <strong>אישור ניהול חשבון בנק:</strong><br>\r\n            ${body.bankApproval === 'pdf-attachment' ? \r\n              '(מצורף כקובץ PDF)' : \r\n              `<a href=\"${body.bankApproval}\" target=\"_blank\" style=\"color: #0070f3; text-decoration: none; margin-right: 10px;\">\r\n                👁️ צפייה\r\n              </a>`\r\n            }\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>`;\r\n\r\n    const emailOptions = {\r\n      from: 'onboarding@resend.dev',\r\n      to: 'shhadytours@gmail.com',\r\n      subject: `טופס חדש - ${body.fullName}${agentFullName ? ` (${agentFullName})` : ''}`,\r\n      html: emailContent,\r\n    };\r\n\r\n    // Add PDF attachment if exists\r\n    if (bankApprovalPdf) {\r\n      emailOptions.attachments = [{\r\n        filename: `bank-approval-${body.fullName}.pdf`,\r\n        content: pdfBuffer,\r\n        contentType: 'application/pdf',\r\n      }];\r\n    }\r\n\r\n    console.log('Sending email with options:', { ...emailOptions, attachments: emailOptions.attachments ? 'PDF Attached' : 'No PDF' });\r\n    const data = await resend.emails.send(emailOptions);\r\n    console.log('Email sent successfully:', data);\r\n\r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Error processing request:', error);\r\n    return NextResponse.json(\r\n      { error: 'שגיאה בעיבוד הבקשה' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}